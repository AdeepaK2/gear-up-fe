<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GearUp - Clear Browser Storage</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 600px;
            width: 100%;
            padding: 40px;
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .info-box {
            background: #f0f4ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 25px;
            border-radius: 5px;
        }
        
        .info-box h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .info-box p {
            color: #555;
            line-height: 1.6;
            font-size: 14px;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        button {
            flex: 1;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-clear {
            background: #667eea;
            color: white;
        }
        
        .btn-clear:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-check {
            background: #f0f4ff;
            color: #667eea;
        }
        
        .btn-check:hover {
            background: #e0e8ff;
        }
        
        .btn-reload {
            background: #10b981;
            color: white;
        }
        
        .btn-reload:hover {
            background: #059669;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
        }
        
        #result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            display: none;
        }
        
        #result.success {
            background: #d1fae5;
            border: 2px solid #10b981;
            color: #065f46;
            display: block;
        }
        
        #result.info {
            background: #dbeafe;
            border: 2px solid #3b82f6;
            color: #1e3a8a;
            display: block;
        }
        
        .token-info {
            background: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .token-info pre {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #374151;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .steps {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 1px solid #e5e7eb;
        }
        
        .steps h3 {
            color: #374151;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .steps ol {
            padding-left: 20px;
        }
        
        .steps li {
            color: #555;
            margin-bottom: 10px;
            line-height: 1.6;
        }
        
        .icon {
            font-size: 20px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß GearUp Chatbot - Fix Tool</h1>
        <p class="subtitle">Clear old authentication tokens and fix chatbot access</p>
        
        <div class="info-box">
            <h3>üìã Why do I need this?</h3>
            <p>
                If you verified your email AFTER logging in, your browser might still have an old authentication token
                that was created before verification. This causes the chatbot to show "Unauthorized" errors.
                This tool will clear the old token so you can log in again with a fresh, verified token.
            </p>
        </div>
        
        <div class="button-group">
            <button class="btn-check" onclick="checkToken()">
                <span class="icon">üîç</span>Check Current Token
            </button>
            <button class="btn-clear" onclick="clearStorage()">
                <span class="icon">üßπ</span>Clear Storage
            </button>
        </div>
        
        <div id="result"></div>
        
        <div class="steps">
            <h3>üìù Steps to Fix Chatbot Access:</h3>
            <ol>
                <li><strong>Click "Check Current Token"</strong> to see if you have an old token</li>
                <li><strong>Click "Clear Storage"</strong> to remove the old authentication data</li>
                <li><strong>Go back to GearUp</strong> and log in again with your verified email</li>
                <li><strong>Test the chatbot</strong> - it should now work perfectly! üéâ</li>
            </ol>
        </div>
    </div>
    
    <script>
        function checkToken() {
            const result = document.getElementById('result');
            const token = localStorage.getItem('accessToken');
            const user = localStorage.getItem('user');
            
            if (!token && !user) {
                result.className = 'info';
                result.innerHTML = `
                    <strong>‚úÖ No old tokens found!</strong><br>
                    Your browser storage is clean. You can log in normally.
                `;
                return;
            }
            
            let tokenInfo = '';
            
            if (token) {
                try {
                    // Decode JWT token (basic decoding, no verification)
                    const base64Url = token.split('.')[1];
                    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                    const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                    }).join(''));
                    
                    const decoded = JSON.parse(jsonPayload);
                    const exp = decoded.exp ? new Date(decoded.exp * 1000) : null;
                    const now = new Date();
                    const isExpired = exp && exp < now;
                    
                    tokenInfo = `
                        <div class="token-info">
                            <strong>üé´ Token Found:</strong>
                            <pre>${JSON.stringify(decoded, null, 2)}</pre>
                            <p style="margin-top: 10px; ${isExpired ? 'color: #dc2626;' : 'color: #059669;'}">
                                <strong>${isExpired ? '‚ö†Ô∏è Token EXPIRED' : '‚úÖ Token Valid'}</strong>
                                ${exp ? ` - Expires: ${exp.toLocaleString()}` : ''}
                            </p>
                        </div>
                    `;
                } catch (e) {
                    tokenInfo = `
                        <div class="token-info">
                            <strong>‚ö†Ô∏è Invalid Token Found</strong>
                            <p>Token exists but cannot be decoded. It should be cleared.</p>
                        </div>
                    `;
                }
            }
            
            let userInfo = '';
            if (user) {
                try {
                    const userData = JSON.parse(user);
                    userInfo = `
                        <div class="token-info" style="margin-top: 10px;">
                            <strong>üë§ User Data:</strong>
                            <pre>${JSON.stringify(userData, null, 2)}</pre>
                        </div>
                    `;
                } catch (e) {
                    userInfo = `
                        <div class="token-info" style="margin-top: 10px;">
                            <strong>‚ö†Ô∏è Invalid User Data</strong>
                        </div>
                    `;
                }
            }
            
            result.className = 'info';
            result.innerHTML = `
                <strong>üîç Storage Check Results:</strong><br>
                Found ${token ? '1 token' : 'no token'}${user ? ' and user data' : ''}
                ${tokenInfo}
                ${userInfo}
                <p style="margin-top: 15px; font-weight: bold;">
                    üí° Click "Clear Storage" to remove old authentication data
                </p>
            `;
        }
        
        function clearStorage() {
            const result = document.getElementById('result');
            
            // Store what we're about to clear
            const hadToken = localStorage.getItem('accessToken') !== null;
            const hadUser = localStorage.getItem('user') !== null;
            const hadRefreshToken = localStorage.getItem('refreshToken') !== null;
            
            // Clear all authentication-related data
            const clearedItems = [];
            if (hadToken) clearedItems.push('Access Token');
            if (hadRefreshToken) clearedItems.push('Refresh Token');
            if (hadUser) clearedItems.push('User Data');
            
            // Clear localStorage
            localStorage.clear();
            
            // Clear sessionStorage as well
            sessionStorage.clear();
            
            result.className = 'success';
            result.innerHTML = `
                <strong>‚úÖ Storage Cleared Successfully!</strong><br><br>
                Removed: ${clearedItems.length > 0 ? clearedItems.join(', ') : 'Nothing (storage was already clean)'}<br><br>
                <strong>Next Steps:</strong>
                <ol style="margin-top: 10px; padding-left: 20px;">
                    <li>Return to GearUp application</li>
                    <li>Log in with your verified email and password</li>
                    <li>Try using the chatbot - it should work now! üéâ</li>
                </ol>
                <br>
                <button class="btn-reload" onclick="location.href='http://localhost:3000'" style="width: 100%; margin-top: 10px;">
                    <span class="icon">üè†</span>Go to GearUp Login
                </button>
            `;
        }
        
        // Auto-check on load
        window.addEventListener('load', () => {
            checkToken();
        });
    </script>
</body>
</html>
